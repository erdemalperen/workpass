TuristPass Frontend İnceleme Raporu — Admin Modülü
Tarih: 2025-10-28

1) Genel Mimari ve Teknoloji Yığını
- Framework: Next.js 15 (App Router), React 18, TypeScript
- UI: TailwindCSS, shadcn/ui (Radix temelli), lucide-react ikon seti, sonner (toast)
- Dosya yapısı (frontend):
  - `app/` (route bazlı sayfalar)
  - `components/` (UI ve özellik bileşenleri)
  - `components/admin/*` (Admin panel bileşenleri)
  - `lib/` (servisler, mock veriler, tipler)
  - `hooks/`, `public/`, `components/ui/*` (shadcn UI)
- Build/Config: `next.config.js` (ESLint build sırasında ignore, images: unoptimized), `tailwind.config.ts`, `tsconfig.json`
- Veri akışı: Şu an tamamı client-side; gerçek API veya veritabanı bağlantısı yok. Mock veri ve localStorage tabanlı oturum.

2) Admin Modülü – Rota ve Layout Mimarisi
- Admin rotaları: `app/admin/*`
  - Alt sayfalar: `dashboard`, `customers`, `businesses`, `passes`, `orders`, `support`, `analytics`, `settings`, `login`
  - Her alt sayfa dosyası sadece ilgili admin bileşenini render ediyor (örn. `app/admin/passes/page.tsx` -> `<AdminPassesWorking />`).
- Admin layout:
  - `app/admin/layout.tsx` sadece `{children}` döndürüyor; gerçek layout `components/admin/AdminLayout.tsx` içinde.
  - `components/admin/AdminLayout.tsx`:
    - Yetkilendirme: `adminAuthService` ile localStorage bazlı kontrol. Auth yoksa `/admin/login`’a yönlendirme. 30 dk oturum zaman aşımı (SESSION_TIMEOUT).
    - Navigasyon: İzinlere göre link filtreleme (`permissions` anahtarları: `customers`, `businesses`, `passes`, `orders`, `support`, `settings`, `analytics`). Aktif rota vurgusu var.
    - UI: Desktop sidebar + mobil Sheet menü; kullanıcı avatar/isim/rol; Logout butonu; bildirim ikonu placeholder.
- Global layout:
  - `components/ConditionalLayout.tsx`: `/admin` ve `/business` rotalarında Navbar/Footer kaldırılır, admin kendi layout’unu kullanır.

3) Kimlik Doğrulama ve Yetkilendirme (Mevcut Durum)
- Dosya: `lib/services/adminAuthService.ts`
  - Demo giriş: `admin@turistpass.com / Admin123!@#` (hardcoded)
  - Depolama: `localStorage` (`turistpass_admin` anahtarı)
  - Oturum süresi: 30 dk; süresi dolunca `/admin/login?session=expired`’a yönlendirir.
  - Rol/İzin: `Admin` tipi (`lib/types/admin.ts`) ile `role` (`super_admin` | `admin` | `support`) ve boolean `permissions` alanları.
- Güvenlik değerlendirmesi:
  - Tamamen client-side; localStorage manipüle edilebilir. Üretim için uygun değil.
  - Rota koruması sadece client’ta useEffect ile yapılıyor; SSR tarafında koruma yok; middleware yok.

4) Sayfa/Bileşen Bazında İnceleme
- Login (`components/admin/AdminLoginPage.tsx`):
  - Form state local; demo bilgileri UI’da gösteriliyor; oran sınırlama/lock yok.
  - Başarılı login sonrası `/admin/dashboard`.
- Dashboard (`components/admin/AdminDashboard.tsx`):
  - Stat kartları, Quick actions, Recent activity (mock); `AdminLayout` ile sarılı.
- Customers (`components/admin/AdminCustomers.tsx`):
  - Arama, durum filtresi, stat kartları, satır aksiyon menüsü; veri mock.
  - Erişim kontrolü: `adminAuthService.hasPermission('customers')`.
- Businesses (iki varyant):
  - Basit: `AdminBusinesses.tsx` (liste/filtre/stat, mock)
  - Gelişmiş: `AdminBusinessesWorking.tsx`:
    - Sekmeler: Active, Applications, Suspended, All
    - İşlemler: detay görüntüleme, düzenleme, askıya alma/aktif etme, toplu bildirim, şifre sıfırlama, yeni işletme oluşturma, başvuru onay/red.
    - Durum: Çok kapsamlı UI akışları; tüm veri mock (`lib/mockData/adminBusinessesData.ts`, tipler `lib/types/adminBusiness.ts`).
    - Erişim: `hasPermission('businesses')`.
- Passes (iki varyant):
  - Basit: `AdminPasses.tsx` (liste, “Create New Pass” diyalogu)
  - Gelişmiş: `AdminPassesWorking.tsx`:
    - Create/Edit dialog: Tabs [basic, pricing, venues, content]
    - Dinamik alanlar: features/benefits/pricing/venues ekleme-çıkarma; preview/edit/delete akışları
    - Mock veri/tipler: `lib/mockData/adminPassesData.ts`, `lib/types/adminPass.ts`
    - İstatistikler: `adminPassesStats`
    - Erişim: `hasPermission('passes')`
- Orders (`components/admin/AdminOrders.tsx`):
  - Arama, durum filtresi, stat kartları, Export butonu (işlev yok), satır aksiyonu; mock veri; `hasPermission('orders')`.
- Support (`components/admin/AdminSupport.tsx`):
  - Arama, durum filtresi, ticket listesi, dialog ile cevap gönderme (toast), mock; `hasPermission('support')`.
- Analytics (`components/admin/AdminAnalytics.tsx`):
  - Gelir, kullanıcı, satış, venue metrikleri ve listeler; mock; `hasPermission('analytics')`.
- Settings (`components/admin/AdminSettings.tsx`):
  - Tabs: Contact/Footer/Social/General; formlar local state + toast; `hasPermission('settings')`.

5) Tipler ve Mock Veri (Örnekler)
- Admin tipi: `lib/types/admin.ts` (rol + permissions matrisi)
- Pass tipi: `lib/types/adminPass.ts` (pricingOptions, venues, usageRule, content vs.)
- Mock kaynakları: `lib/mockData/adminPassesData.ts`, `adminBusinessesData.ts` (yardımcı getter fonksiyonlarıyla)

6) Durum Yönetimi ve Formlar
- Ağırlıkla React `useState`/`useEffect`. `react-hook-form` ve `zod` projede var ancak admin formlarında aktif kullanılmıyor.
- Veri eşzamanlama yok (react-query/SWR kullanılmıyor); her şey bileşen içi state.

7) UI/UX Notları
- Tutarlı shadcn UI kullanımı, responsive grid/stack düzenleri, ikonlarla zenginleştirilmiş liste/satır aksiyonları.
- AdminLayout: mobil/desktop uyumlu; izin temelli menü; oturum açma/çıkış akışları net.

8) Kod Kalitesi ve Yapılandırma
- `next.config.js`: `eslint.ignoreDuringBuilds = true` (potansiyel sorunları gizleyebilir). `images.unoptimized = true`.
- SSR güvenliği yok; API/Route Handler yok; Middleware yok.
- Test altyapısı görünmüyor (unit/e2e).

9) Supabase Entegrasyon Planı (Öneri)
9.1) Auth ve Rotaların Korunması
- Supabase Auth (Email+Password + MFA opsiyonel).
- Admin profilleri: `admin_profiles` tablosu (id uuid PK = `auth.users.id`, email, name, role, permissions JSONB).
- Next.js Middleware: `/admin` path’inde Supabase server-side cookie kontrolü; yetkisiz ise `/admin/login` redirect (SSR “flash” olmadan).
- `adminAuthService` yerine:
  - İstemci: yalnızca `supabase-js` ile `auth.signInWithPassword`, `signOut`.
  - Sunucu: `@supabase/ssr` veya `createServerClient` ile cookie tabanlı doğrulama; izin kontrolü server’da.

9.2) Veri Modeli (Tablolar — çekirdek)
- users (Supabase auth.users) — Son kullanıcılar
- admin_profiles (id, email, name, role, permissions)
- businesses (id, name, slug, email, category_id, status, contact JSONB, location JSONB, details JSONB, created_at, updated_at)
- business_applications (id, business_name, contact JSONB, category, location JSONB, details JSONB, status, created_at)
- venues (id, name, slug, category, address/district/city, coordinates, contact, images, status)
- passes (id, slug, name, description, short_description, status, featured, popular, color, background_color, banner_image, cancellation_policy, created_at, updated_at)
- pass_pricing_options (id, pass_id FK, days, age_group, base_price, discount_percent)
- pass_venues (id, pass_id FK, venue_id FK, discount_percent, usage_type enum[once_per_venue|unlimited|limited_count], max_usage_per_venue)
- customers (id, email, first_name, last_name, phone, status, joined_at)
- orders (id, customer_id FK, total_amount, status, created_at)
- order_items (id, order_id FK, pass_id FK, quantity, unit_price)
- support_tickets (id, from_user/business/admin, subject, body, status, priority, created_at)
- metrics_aggregates (isteğe bağlı dashboard/analytics için)

9.3) RLS Politikaları (özet)
- admin_profiles: sadece admin kendi profilini okuyabilir; yönetim panelleri için role bazlı policy (örn. role in ['admin','super_admin']).
- businesses: admin rolü full erişim; business portalda sadece kendi kaydını okuyup güncelleyebilir (row owner = business auth.user_id).
- passes: admin full CRUD; public sadece aktif pass’leri okuyabilir.
- orders/customers: admin okuyabilir (ve gerekli durumlarda yazabilir); kullanıcı sadece kendi siparişini görür.
- support_tickets: admin tümünü; kullanıcı ve işletme yalnızca kendininkini.

9.4) Next.js Uygulama Tarafı
- `lib/supabase/server.ts` ve `lib/supabase/client.ts` (server/client ayrı client factory)
- `middleware.ts`: `/admin` koruması
- `app/api/*` route handlers veya Server Actions ile CRUD (Sunucu tarafında service_role key kullanmayın; Route Handler içinde `createServerClient` + RLS yeterli. Admin işlemleri için “admin function” gerekirse Edge Function/Supabase Function + service role).
- Admin sayfalarında mockData yerine Supabase çağrıları:
  - Listeleme: `select` + filtre + sayfalama
  - Oluşturma/Düzenleme/Silme: `insert`/`update`/`delete` + hata/başarı toasts
  - Forms: `react-hook-form` + `zod` ile doğrulama

9.5) Şema — Örnek SQL (özet)
- Admin profili:
  - create table admin_profiles(id uuid primary key references auth.users(id), email text unique not null, name text, role text check (role in ('super_admin','admin','support')) not null, permissions jsonb not null default '{}');
- Pass pricing:
  - create table pass_pricing_options(id uuid primary key default gen_random_uuid(), pass_id uuid references passes(id) on delete cascade, days int not null, age_group text check (age_group in ('adult','child','student','senior')), base_price numeric not null, discount_percent int default 0);
- Pass venues:
  - create table pass_venues(id uuid primary key default gen_random_uuid(), pass_id uuid references passes(id) on delete cascade, venue_id uuid references venues(id), discount_percent int default 0, usage_type text check (usage_type in ('once_per_venue','unlimited','limited_count')) not null, max_usage_per_venue int);
- RLS örneği:
  - enable row level security on passes;
  - create policy admin_read on passes for select using (exists (select 1 from admin_profiles ap where ap.id = auth.uid() and ap.role in ('admin','super_admin')));

9.6) Migrasyon ve Araçlar
- Supabase CLI ile `supabase init`, `supabase gen types typescript --local` (tipleri `lib/types/generated`’a), SQL migrasyonları repo içinde versiyonlayın.

10) Eksikler, Riskler ve İyileştirme Önerileri
- Güvenlik: localStorage tabanlı auth → Supabase Auth + Middleware ile server-side koruma şart.
- Veri: Mock → gerçek tablo ve CRUD; sayfalama/sıralama/filtreleme server-side yapılmalı.
- Form doğrulama: `react-hook-form` + `zod` adaptasyonu önerilir.
- Hata yönetimi: try/catch ve kullanıcıya anlamlı mesajlar; toast + inline hata alanları.
- Erişilebilirlik: ARIA/rol/label kontrolleri; klavye navigasyonu.
- İzleme/Loglama: Sentry/LogRocket gibi araçlarla admin hatalarını ve kullanıcı akışlarını izleyin.
- ESLint: build ignore kapatılmalı, kurallar sıkılaştırılmalı; type güvenliği artırılmalı.

11) İzin Matrisi ve Navigasyon (Mevcut)
- İzin anahtarları: `customers`, `businesses`, `passes`, `orders`, `support`, `settings`, `analytics`
- `AdminLayout` menüyü bu anahtarlara göre filtreliyor; sayfalar ayrıca `hasPermission('<key>')` ile korumalı.

12) Yol Haritası (Admin için önerilen adımlar)
A. Altyapı
  1. Supabase projesi açın; .env.local’a `NEXT_PUBLIC_SUPABASE_URL`, `NEXT_PUBLIC_SUPABASE_ANON_KEY` ekleyin.
  2. Şema tablolarını oluşturun; RLS’yi aktif edin; admin_profiles kayıtlarını hazırlayın.
  3. `middleware.ts` ile `/admin` korumasını ekleyin.
B. Auth/Yetki
  4. `AdminLoginPage` → `supabase.auth.signInWithPassword` kullanacak şekilde güncelleyin.
  5. `AdminLayout`’u server-side cookie denetimi (SSR) ile güçlendirin; client-only kontrolü kaldırın.
C. Modülerleşme
  6. `AdminPassesWorking` → Supabase CRUD; mock kaldırma; tablo ayrışımı (passes/pricing/venues).
  7. `AdminBusinessesWorking` → başvuru akışları (applications) ve işletme CRUD.
  8. `Orders`, `Customers`, `Support`, `Analytics` → gerçek sorgular; sayfalama ve export için `COPY`/CSV üretimi veya edge function.
D. DX/Kalite
  9. `react-hook-form` + `zod` ile tüm formlarda doğrulama.
  10. ESLint/Prettier, typecheck (strict), test altyapısı (Vitest/RTL) ve e2e (Playwright/Cypress).

13) Node.js vs .NET Notu (Backend tercihi - ön bilgi)
- Bu proje App Router + Supabase ile serverless odaklı ilerlediğinden Node.js (Next.js route handlers/server actions) ile entegrasyon daha hızlı olacaktır.
- .NET tercih edilirse: ayrı API katmanı + Supabase Postgres bağlantısı (Npgsql) + JWT doğrulayıcı gerekir; ek devre ve bakım maliyeti artar.

Özet (Admin):
- Mevcut admin paneli UI açısından kapsamlı ve üretime yakın; veri/kimlik doğrulama ise demo/mock düzeyinde.
- İlk adım olarak Supabase Auth + Middleware + tablo şemasının hayata geçirilmesi; ardından modül modül (Passes/Businesses/Orders/Customers/Support/Analytics) CRUD ve raporlama uçlarının bağlanması önerilir.


TuristPass Frontend İnceleme Raporu — Customer (Kullanıcı) Modülü

1) Genel Bakış ve Rotalar
- Kullanıcıya açık ana rotalar: `app/login`, `app/signup`, `app/forgot-password`, `app/profile`, `app/my-passes`, `app/favorites`, `app/messages`, `app/savings`, `app/places`, `app/places/[slug]`.
- Layout: `components/ConditionalLayout.tsx` ile public rotalarda Navbar/Footer aktif, `business` ve `admin` rotalarında devre dışı.
- Görsel/UX: shadcn/ui bileşenleri, duyarlı grid yapıları, ikonlarla zengin listeler.

2) Kimlik Doğrulama – Mevcut Durum (authService)
- Dosya: `lib/services/authService.ts` (mock kullanıcı, localStorage + sessionStorage, 24 saat session, storage event listener’ları).
- Login/Signup client-side; SSR/middleware koruması yok. Redirect için `?redirect=` parametresi kullanılıyor.
- Risk: localStorage manipüle edilebilir, sayfa client mount olana kadar kısa “flash” yaşanır.

3) Sayfa ve Bileşen İncelemeleri
- Login (`components/auth/LoginPage.tsx`)
  - Email/şifre doğrulama, demo bilgiler blokta gösteriliyor, başarıda `router.push(redirect)` + kısa `window.location.href` yenilemesi.
- Signup (`components/auth/SignupPage.tsx`)
  - İsim/soyisim/email/şifre validasyonları; şifre karmaşıklık kontrolü; Terms onayı zorunlu; başarıda redirect.
- Forgot Password (`components/auth/ForgotPasswordPage.tsx`)
  - Sadece simülasyon: email formu, gönderim sonrası 60sn geri sayım, yeniden gönder butonu; gerçek e-posta yok.
- Profile (`components/profile/ProfilePage.tsx`)
  - Auth zorunlu; profil görüntüleme/düzenleme (`authService.updateProfile`); istatistik kartları (aktif pass, favoriler, toplam tasarruf).
- My Passes (`components/profile/MyPassesPage.tsx`)
  - Auth zorunlu; aktif/süresi dolmuş pass listesi; QR code URL üretimi (harici API) ve sahte PIN üretimi; partner lokasyon linki.
- Favorites (`components/profile/FavoritesPage.tsx`)
  - Auth zorunlu; `user.favorites` id listesine göre statik mekanlardan filtre; favoriden çıkarma local state + `authService.updateProfile`.
- Messages (`components/profile/MessagesPage.tsx`)
  - Auth zorunlu; bildirim/teklif/uyarı tiplerinde mock mesajlar; okundu işaretleme; “New” rozeti.
- Savings (`components/profile/SavingsPage.tsx`)
  - Auth zorunlu; sahte tasarruf geçmişi; toplam/aylık/ortalama metrikleri hesaplanıyor.
- Places (`app/places` ve `app/places/[slug]`)
  - Liste sayfası `components/Places` (kategoriler ve kartlar, mock data).
  - Detay sayfası modüler: `PlaceHeader`, `PlaceGallery`, `AboutTab`, `OfferTab`, `NeedToKnowTab`, `ReviewsTab`, `LocationTab`, sağda `PassInfo` + `PassSelectionSidebar`.
  - Veri: `lib/mockData/placesData.ts`, `passesData.ts` (başta `populatePassesWithPlaces` ile bağlama).

4) Tipler ve Mock Veriler
- Places veri modeli zengin: `Place`, `PlaceCategory`, `PlaceImage`, `PlaceReview`, `PlaceBranch`, `PlaceActivity` vb.
- Pass verileri: `passesData` (pass options, features, includedPlaces), `popularPassesData` (selection UI).

5) Mevcut Eksikler / Riskler (Customer)
- Auth tamamen client-side; middleware/SSR koruma yok.
- Tüm içerik mock; serverdan sayfalama/filtre yok.
- QR/PIN üretimi sahte; güvenlik ve sahada kullanım için uygun değil.
- Favoriler, mesajlar, tasarruf geçmişi kalıcı değil; kullanıcı/cihaz bağımlı.

6) Supabase Entegrasyon Planı (Customer)
6.1) Tablolar (özet)
- user_profiles (id uuid PK = auth.users.id, first_name, last_name, avatar, joined_at, total_savings numeric)
- favorites (id, user_id FK, place_id FK, created_at)
- notifications (id, user_id FK, type enum, title, content, read bool, created_at)
- orders (id, user_id FK, total_amount, status, created_at)
- order_items (id, order_id FK, pass_id FK, qty, unit_price, expiry_date)
- user_pass_tokens (id, order_item_id FK, code unique, pin, valid_from, valid_to, used_at)
- passes, pass_pricing_options, pass_venues (admin tarafıyla ortak)
- places, place_images, place_categories (admin/business tarafıyla ortak)
- savings_logs (opsiyonel) veya görünüm: orders/order_items’dan hesaplanabilir

6.2) RLS (özet)
- user_profiles/favorites/notifications/orders/order_items/user_pass_tokens: `user_id = auth.uid()` kayıtlarına erişim.
- places/passes: public select (yalnızca `status=active`).

6.3) Uygulama Değişiklikleri
- Auth
  - Login/Signup: `supabase.auth.signInWithPassword` / `signUp`; Forgot Password: `auth.resetPasswordForEmail`.
  - Middleware: `/profile`, `/my-passes`, `/favorites`, `/messages`, `/savings` koruması (SSR flash’ı önler).
- Profile
  - `GET user_profiles` (server), `UPDATE user_profiles` (server action/route handler); avatar yükleme için storage.
- My Passes
  - `SELECT order_items JOIN passes` ile aktif/süresi dolmuş ayırımı; `user_pass_tokens.code` üzerinden QR oluşturma (ör. `tp:CODE`).
- Favorites
  - `favorites` tablosundan join `places`; ekle/çıkar mutasyonları.
- Messages
  - `notifications` tablosu; okundu flag’ı güncelleme.
- Savings
  - `savings_logs` veya `orders` üzerinden hesaplanan metrikler (server sorgusu); tarih filtresi/sayfalama.
- Places
  - Liste/detay sorguları Supabase’ten; `[slug]` server tarafında fetch; `PassSelectionSidebar` seçeneklerini `pass_pricing_options`’tan doldur; “Buy Now” → orders akışı.

6.4) Kod/DX
- `lib/supabase/client.ts` ve `lib/supabase/server.ts`; `@supabase/ssr`.
- `middleware.ts` ile koruma.
- `react-hook-form` + `zod` doğrulama (Login/Signup/Profile).
- Tipler: `supabase gen types` ile otomatik TS tipleri.

7) Yol Haritası (Customer)
1. Supabase kurulum + .env + şema ve RLS (profiles/favorites/notifications/orders/...)
2. Middleware ekle (korumalı rotalar).
3. Login/Signup/ForgotPassword’ı Supabase’e geçir.
4. Profile → `user_profiles` ile bağla (GET/UPDATE, avatar storage).
5. My Passes → `orders/order_items/user_pass_tokens`; QR/PIN üretimini güvenli hale getir.
6. Favorites → `favorites` CRUD.
7. Messages → `notifications` liste/okundu güncellemesi.
8. Savings → metrikler server tarafında hesaplanıp gösterilsin.
9. Places → Supabase’ten liste/detay, pass opsiyonlarıyla entegre alışveriş akışı.

8) Ek Öneriler
- Hata yönetimi ve boş durum bileşenleri standartlaştırılsın.
- Analytics için event takibi (pageview, add_to_favorites, purchase_completed) eklenebilir.
- Erişilebilirlik (a11y) ve i18n (TR/EN) planı yapılabilir.


TuristPass Frontend İnceleme Raporu — Business (Mağaza) Modülü

1) Genel Bakış ve Rotalar
- Business portal rotaları: `app/business/*`
  - Alt sayfalar: `dashboard`, `scanner`, `history`, `profile` (My Venue), `reviews`, `support`, `notifications`, `login`, `apply`.
- Layout:
  - `app/business/layout.tsx` sadece `{children}` döndürüyor; gerçek layout `components/business/BusinessLayout.tsx` içinde.
  - `BusinessLayout` auth kontrolü, responsive sidebar, bildirim menüsü, venue bilgileri ve logout içerir.
- Navigasyon (BusinessLayout): Dashboard, Scanner, History, My Venue, Reviews, Support. Bildirimler ayrı sayfada.

2) Kimlik Doğrulama – Mevcut Durum (businessAuthService)
- Dosya: `lib/services/businessAuthService.ts` (mock hesap, localStorage + sessionStorage, 24 saat session).
- Login formu `BusinessLoginPage` üzerinden; başarıda `/business/dashboard`.
- Kısıtlar: client-side `useEffect` ile kontrol; SSR/middleware yok; localStorage manipülasyona açık; hesap `status` değerleri (active/pending/suspended) var fakat gerçek backend denetimi yok.

3) Sayfa/Bileşen İncelemeleri
- BusinessLayout (`components/business/BusinessLayout.tsx`)
  - Auth yoksa `/business/login` redirect (client-side). Sidebar (desktop) + drawer (mobile), venue kartı, unread bildirim sayacı, logout akışı.
- Dashboard (`BusinessDashboard.tsx`)
  - İstatistik kartları (Total Visits/This Month/Today), Quick Actions (Scanner/History/My Venue), Recent Scans (mock). `BusinessLayout` ile sarılı.
- Scanner (`BusinessScanner.tsx`)
  - Sekmeler: QR Scanner (simülasyon) ve PIN doğrulama (regex ile `TP\d{4}[A-Z]{2}`); sonuç kartı ve mevcut indirim gösterimi. Gerçek doğrulama yok.
- History (`BusinessHistory.tsx`)
  - Arama, dönem filtresi, tarih bazlı gruplanmış ziyaretler, Export butonu (işlevsiz). Veri mock.
- Profile/My Venue (`BusinessProfile.tsx`)
  - Tabs: Info, Images, Hours, Features. İletişim/konum/indirim/açıklama düzenleme; galeri; çalışma saatleri switch’leri; özellikler (wifi/parking vs). Kayıt işlemleri toast ile simüle ediliyor.
- Reviews (`BusinessReviews.tsx`)
  - Ortalama puan, dağılım, filtre (all/replied/pending), cevap yazma akışı (mock), helpful sayacı.
- Support (`BusinessSupport.tsx`)
  - Tabs: Submit Ticket, My Tickets, Contact. Bilet listesi ve oluşturma (mock). Durum/öncelik rozetleri.
- Notifications (`BusinessNotifications.tsx`)
  - Bildirim listesi (success/info/alert/offer tipleri), okunmamış rozetleri (mock).
- Apply (`BusinessApplyPage.tsx`)
  - İşletme başvuru formu; `businessAuthService.register` ile simülasyon; başarı ekranı. Gerçek kayıt yok.

4) Tipler ve Mock Veriler
- `lib/types/business.ts` → `BusinessPlace`, `CustomerScan`, `SupportTicket` vb. alanlar; UI kapsamı geniş (konum, iletişim, çalışma saatleri, özellikler, istatistikler).
- Business verisi `businessAuthService` içinde MOCK_BUSINESSES ile başlatılıyor.

5) Mevcut Eksikler / Riskler (Business)
- Auth/Yetki: SSR/middleware yok; client-side kontrol üretim için yetersiz.
- Veri: Tüm akış mock; gerçek CRUD, sayfalama, filtreleme yok.
- Scanner: PIN/QR doğrulaması gerçek değil; indirim uygulama ve kullanım sınırları kontrol edilmiyor.
- Görseller: Upload/storage akışı yok; sadece gösterim.
- Export/raporlama: yerinde değil; sahte/boş.

6) Supabase Entegrasyon Planı (Business)
6.1) Tablolar (özet)
- auth.users (işletme hesapları da burada tutulur)
- business_accounts (id uuid PK = auth.users.id, business_id uuid FK, status, role?)
- businesses (BusinessPlace karşılığı; name, slug, category_id, contact JSONB, location JSONB, images JSONB, features, open_hours, discount, price_range, status, joined_at, updated_at)
- partner_applications (başvuru formu verileri; status: pending/approved/rejected; audit alanları)
- reviews (id, business_id FK, user_id FK, rating, comment, created_at)
- review_replies (id, review_id FK, replied_by (business/admin), text, created_at)
- business_notifications (id, business_id FK, type, title, content, read bool, created_at)
- support_tickets (id, business_id FK, subject, priority, status, created_at)
- support_responses (id, ticket_id FK, sender, message, created_at)
- scans (id, business_id FK, user_id FK nullable, pass_id FK, token_code, method enum[qr,pin], discount_applied, created_at)
- user_pass_tokens (müşteri tarafıyla ortak; code unique, pass/option, valid_from/to, usage counters)

6.2) RLS Politikaları (özet)
- business_accounts: `id = auth.uid()` satırına erişim.
- businesses: sadece sahibi (business_accounts.business_id) UPDATE/SELECT; public SELECT sınırlı (aktif işletmeler).
- scans: `business_id` kendi olan kayıtları okuyabilir/ekleyebilir.
- business_notifications/support_tickets/reviews: ilgili `business_id` ile sınırlı erişim.
- user_pass_tokens: doğrudan SELECT vermeyin; sadece RPC/Edge Function ile doğrulama.

6.3) Uygulama Değişiklikleri
- Middleware: `/business` altında cookie tabanlı Supabase kontrolü; flash yok.
- Login: `supabase.auth.signInWithPassword` + `business_accounts` join ile `business_id` alın.
- Dashboard: metrikleri `scans` ve toplanmış görünümlerden çekin (ör. son 7 gün).
- Scanner: kamera/QR kütüphanesi + PIN input → sunucuda doğrulama (bkz. 6.4) ve `scans` insert.
- History: `scans` tablosundan filtre/sayfalama (server query); CSV export için route handler.
- Profile: `businesses` UPDATE; görsel yükleme Supabase Storage (signed URL) + metadata.
- Reviews: `reviews` listesi; `review_replies` INSERT; sayfalama/sıralama.
- Support: `support_tickets`/`support_responses` CRUD; durum değişimi.
- Notifications: `business_notifications` listesi ve `read` güncelleme.
- Apply: `partner_applications` INSERT; onaylandığında `businesses` + `business_accounts` oluşturma (Edge Function veya admin panelinden).

6.4) Tarama (Scanner) — Güvenli Doğrulama Akışı
- RPC/Edge Function: `validate_and_consume_token(business_id uuid, code text)`
  - Adımlar: (1) token bul, tarih/aktiflik kontrolü (2) pass_venues ile bu işyeri yetkili mi (3) kullanım kuralları (once_per_venue/limited/unlimited) (4) satır kilidi (FOR UPDATE) ile atomik tüketim (5) `scans` insert + sayaç güncelle (6) özet döndür (müşteri adı anonimleştirilebilir).
  - Neden RPC? RLS ile birlikte atomiklik ve iş kuralı bütünlüğü; client hiçbir zaman doğrudan token görmez.

7) Yol Haritası (Business)
1. Şema + RLS + Supabase Storage (logo/galeri) → migrasyonlar.
2. Middleware ve Supabase client/server kurulum.
3. BusinessLogin → Supabase; BusinessLayout → server-side kimlik bilgisi besleme.
4. Scanner → RPC `validate_and_consume_token` entegrasyonu; QR kütüphanesi ekleme.
5. History → `scans` sorguları; export endpoint.
6. Profile → `businesses` update + görsel upload.
7. Reviews/Replies → gerçek tablolar; sayfalama ve sıralama.
8. Support/Notifications → gerçek tablolar; okunma/durum güncelleme.
9. Apply → partner_applications + otomasyon (mail/webhook/Slack).

8) Ek Öneriler
- İş yeri performans panosu (trend grafikleri, saat/dönem ısı haritası).
- QR offline fallback: kısa süreli imzalı kod + çevrimdışı cache (dikkatli tasarım gerektirir).
- Çoklu şube desteği ve şube bazlı kullanıcı rolleri.
- Olay günlükleme (audit log) ve anti-fraud kontrolleri (oran sınırlama, IP/device fingerprint).
